
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>cd ~/jaequery</title>
	<meta name="author" content="jaequery">

	
	<meta name="description" content="if you are like me and like things where you can get setup in a quick pinch, you&#8217;ll like dnsmasq.
have you ever had a time where you had &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="cd ~/jaequery" type="application/atom+xml">
	
	<link rel="canonical" href="http://jaequery.github.com/blog/page/2/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

	
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-38367647-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>

<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<img src="https://twimg0-a.akamaihd.net/profile_images/1553518100/276361_588421810_1000318656_n.jpg" alt="Profile Picture" style="width: 160px;">
</div>
<h1><a href="/">cd ~/jaequery</a></h1>
<p class="subtitle">Work hard. Aim high. Stay humble. <br>CTO at <a href="http://www.processing.com" target="_blank">processing.com</a></p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/jaequery" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/jaequery" title="GitHub">GitHub</a>
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>


</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/jaequery">jaequery</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('jaequery', 4, false);
	})(jQuery);
</script>

			
			<div class="mid-col-container">
				<div id="content" class="inner">


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-09-13T16:24:49-07:00" pubdate data-updated="true">Sep 13<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/09/13/dnsmasq-as-a-centralized-hosts-file/">Dnsmasq as a Centralized Hosts File</a></h1>
	<div class="entry-content">
		<p>if you are like me and like things where you can get setup in a quick pinch, you&#8217;ll like dnsmasq.
have you ever had a time where you had multiple servers and have wondered why we can&#8217;t just easily have a central hosts file so they are all synchronized?
well look no further. dnsmasq, is that, and more.
install dnsmasq on centos 5.8 is as easy as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install dnsmasq -y</span></code></pre></td></tr></table></div></figure>


<p>that&#8217;s it, you just now need to start it up: service dnsmasq start, and point your other server&#8217;s /etc/resolv.conf to your dnsmasq server.</p>

<p>note) if you are on openvz, make sure you set user=root in /etc/dnsmasq.conf, otherwise it won&#8217;t let you start the service.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-09-13T13:24:31-07:00" pubdate data-updated="true">Sep 13<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/09/13/change-master-host-on-mysql/">Change Master Host on Mysql</a></h1>
	<div class="entry-content">
		<p>CHANGE MASTER TO MASTER_HOST=&#8217;db0.local&#8217;, MASTER_USER=&#8217;xxx&#8217;, MASTER_PASSWORD=&#8217;xxx&#8217;, MASTER_LOG_FILE=&#8217;mysql-bin.000003&#8217;, MASTER_LOG_POS=628;</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-09-11T17:09:27-07:00" pubdate data-updated="true">Sep 11<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/09/11/a-perl-script-to-check-for-system-configuration/">A Perl Script to Check for System Configuration</a></h1>
	<div class="entry-content">
		<pre><code>#!/usr/bin/perl
#  Version 0.0.1.F alpha
#  To use locally.
#   example:    "./pci_check.pl"
#
#  Remotely redirect to ssh.  
#   example:    "ssh username@servername perl &lt; pci_check.pl"
#
#  Looping through multiple servers. 
#   example:    "for server in servername1 servername2 servernameetc; do ssh username@$server perl &lt; pci_check.pl; done"
#
#  Redirect output to local file.
#   example:    "ssh username@servername perl &lt; pci_check.pl &gt;&gt; output.txt"
#
#  Redirecting output to a local file while looping through multiple servers.
#   example:    "for server in servername1 servername2 servernameetc; do ssh username@$server perl &lt; pci_check.pl &gt;&gt; output.txt; done"
#
#  Looping through multiple servers specified from a list.
#   example:    "for server in `cat serverlist.txt` ; do ssh username@$server perl &lt; pci_check.pl; done" 
#

use strict;
my $internet_connectivity_url = "http://www.google.com";

my $which_cmd = "which";
my $etc_passwd_file = "/etc/passwd";
my $etc_login_defs_file = "/etc/login.defs";
my $etc_lsb_release_file = "/etc/lsb-release";
my $etc_redhat_release_file = "/etc/redhat-release";
my $etc_gentoo_release_file = "/etc/gentoo-release";
my $etc_ntp_conf_file = "/etc/ntp.conf";
my $etc_exports_file = "/etc/exports";
my $etc_fstab_file = "/etc/fstab";
my $etc_ssh_sshd_conf_file = "/etc/ssh/sshd_config";
my $var_log_clamav_freshclam_log = "/var/log/clamav/freshclam.log";
my $my_id = `id -u`;
my $sysctl_cmd = "/sbin/sysctl";
my $passwd_cmd = `$which_cmd passwd`;
  chomp $passwd_cmd;
my $curl_cmd = `$which_cmd curl`;
  chomp $curl_cmd;
my $crontab_cmd = `$which_cmd crontab`;
  chomp $crontab_cmd;
my $ifconfig_cmd= `$which_cmd ifconfig`;
  chomp $ifconfig_cmd;



my $hostname = `/bin/hostname`;
my @ps_cmd = `/bin/ps -eo %c h`;
my @ifconfig = `$ifconfig_cmd`;
my @netstat = `/bin/netstat -nlp`;
my @pam_d_contents = `/bin/cat /etc/pam.d/*  2&gt; /dev/null`;
if ($my_id == 0)
  {
    my @crontab = `$crontab_cmd -l`;
  }


my @installed_packages;
my $os_distro;
my $ipv6_status;

my @sysctl_oids = 
  qw( 
    net.ipv4.conf.all.forwarding
    net.ipv4.conf.default.forwarding
    net.ipv4.ip_forward
    net.ipv4.conf.default.accept_source_route
    net.ipv4.conf.all.accept_source_route
  );

my @cron_directories =
  qw(
    /etc/cron.hourly
    /etc/cron.daily
    /etc/cron.weekly
    /etc/cron.montly
    );

my @log_directories =
  qw(
    /var/log
    /var/log/httpd
    );

my @login_defs = open_file($etc_login_defs_file);
my @etc_lsb_release = open_file($etc_lsb_release_file);
my @etc_redhat_release = open_file($etc_redhat_release_file);
my @etc_gentoo_release = open_file($etc_gentoo_release_file);
my @etc_ntp_conf = open_file($etc_ntp_conf_file);
my @etc_exports = open_file($etc_exports_file);
my @etc_fstab = open_file($etc_fstab_file);
my @etc_ssh_sshd_conf = open_file($etc_ssh_sshd_conf_file);
my @etc_passwd = open_file($etc_passwd_file);
my @clamav_freshclam = open_file($var_log_clamav_freshclam_log);


print "Hostname:nt$hostname";

#print whether internet connectivity is detected or not
if ( length($curl_cmd) != 0 )
  {
    if ( `$curl_cmd --silent -m 5 $internet_connectivity_url` )
      {
        print "tINTERNET CONNECTIVITY DETECTEDn";
      }
    else
      {
        print "tNO INTERNET CONNECTIVITYn";
      }
  }

print "OS Version:n";
foreach (@etc_lsb_release)
  {
    if (/DISTRIB_DESCRIPTION="(.*)"/)
      {
        print "t$1n";
    $os_distro = $1;
      }
  }

foreach (@etc_redhat_release)
  {
    if (/(.*)/)
      {
        print "t$1n";
        $os_distro = $1;
      }
  }
foreach (@etc_gentoo_release)
  {
    if (/(.*)/)
      {
         print "t$1n";
         $os_distro = $1;
      }
  }


#Loop through ifconfig for IP Addresses
print "IP Addresses:n";
foreach (@ifconfig)
  {
    if (/inet (?:addr:)?([d.]+)/)
      {
        print "t$1n";
      }
  }  



#Loop through ifconfig for IPv6
foreach (@ifconfig)
  {
    if (/inet6/)
      {
        $ipv6_status = 1;
        last;
      }
  } 

if ($ipv6_status)
  {
    print "IPv6 is Enabledn";
  }
else
  {
    print "IPv6 is Disabledn";
  }


#services
print "Listening Services:n";
foreach (@netstat)
  {
    if (/(tcp|udp).* ([d.d.d.d]+:d+)/)
      {
        print "t$1 $2n";
      }
  }



#Sysctl Values
print "IP sysctl:n";
foreach (@sysctl_oids)
  {
    print "t" . read_sysctl($_);
  }

#Enumerate System Users
print "Users:n";
foreach (@etc_passwd)
  {
    my($login, $passwd, $uid, $gid,$gcos, $home, $shell) = split(/:/);
    print "t$logint$homet$shell";
      if ( $my_id == 0 )
        {
          print "t".`$passwd_cmd -S $login`;
        }
  }


#NTP server configuration
print "NTP Servers:n";
foreach (@etc_ntp_conf)
  {
    if (m/^(server.*)/)
      {
        print "t$1n";
      }
  }

#List filesystem exports
print "Filesystem NFS Exports:n";
foreach (@etc_exports)
  {
    if (!(m/^#/))
      {
    print "t$_";
      }
  }


#etc fstab contents
print "fstab mounts:n";
foreach (@etc_fstab)
  {
    if (!(m/^#/))
      {
        print "t$_";
      }
  }

#etc sshd config contents
if ($my_id == 0)
  {
  print "sshd_conf:n";
  foreach (@etc_ssh_sshd_conf)
    {
      if (!(m/^#/) &amp;&amp; !(m/^$/))
        {
          print "t$_";
        }
    }
  }


#Determine OS and find installed packages
if ($os_distro =~ m/ubuntu/i)
  {
    my @installed_packages_tmp = `/usr/bin/dpkg -l`;
    foreach (@installed_packages_tmp)
      {
        my @line =  split(/s+/, $_);
        push @installed_packages, "$line[1]t$line[2]n";
      }
  }

if ($os_distro =~ m/debian/i)
  {
    my @installed_packages_tmp = `/usr/bin/dpkg -l`;
    foreach (@installed_packages_tmp)
      {
        my @line =  split(/s+/, $_);
        push @installed_packages, "$line[1]t$line[2]n";
      }
  }

if ($os_distro =~ m/gentoo/i)
  {
    @installed_packages = `ls -d /var/db/pkg/*/*`;
  }

if ($os_distro =~ m/centos/i)
  {
    @installed_packages = `rpm -qa`;
  }

if ($os_distro =~ m/red hat/i)
  {
    @installed_packages = `rpm -qa`;
  }


print "Installed packages:n";
foreach (@installed_packages)
  {
    if (m/(.*(ssh|ntp|httpd|apache|named|bind|avg|clam|portmap|sophos|sys|ssl|cups|sec|tripwire).*)/i)
    {
       print "t$1n";
    } 
  }


if (-e $var_log_clamav_freshclam_log)
    {
      print "ClamAV Updates:n";
      foreach (@clamav_freshclam[-30,-1])
        {
          print "t$_";
        }
    }

print "File contents: login.defsn";
foreach (@login_defs)
  {
    if (m/(^(MD5_CRYPT_ENAB|ENCRYPT_METHOD|LOGIN_RETRIES|LOGIN_TIMEOUT|LOG_OK_LOGINS|SYSLOG_SU_ENAB|PASS_MAX_DAYS).*)/i){print "t$1n";}
  }


print "Pam.d config:n";
foreach (@pam_d_contents)
  {
    if ((!(m/^#/) &amp;&amp; ((m/(.*pam_unix.*)/i) || (m/(.*pam_tally.*)/i) || (m/(.*pam_crack.*)/i) || (m/(.*minlen.*)/i) || (m/(.*retry.*)/i)) ) )
      {
        print "t$1n";
      }
  }

print "Cron Jobs:n";
foreach my $file (@cron_directories)
  {
    foreach (&lt;$file/*&gt;)
      {
        print "t $_n";
      }
  }

print "Log Files:n";
foreach my $file (@log_directories)
  {
    foreach (&lt;$file/*&gt;)
      {
    if (!(m/.[0-9]/))
          {
            print "t $_n";
          }
      }
  }


#Sort unique processes 
print "System Processes:n";
my %seen;
foreach ( sort( grep{ ! $seen{$_}++ } @ps_cmd))
  {
    print "t$_";
  }




#Argument filename, Returns array
sub open_file
  {
    my $file_name = $_[0];
    open FILE, ")
      {
        push(@file_contents, $_);
      }
    close FILE;
    return @file_contents;
  }

#Read specific sysctl
sub read_sysctl
  {
    my $search_oid=$_[0];
    open SYSCTL, "$sysctl_cmd $search_oid |" || die "Can't run sysctl: $!n";
    my $output;
    while ()
      {
        $output = $_;
      }
    close SYSCTL;
    return $output;
  }
</code></pre>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-09-05T15:43:11-07:00" pubdate data-updated="true">Sep 5<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/09/05/encrypt-decrypt-tar-backups/">Encrypt / Decrypt Tar Backups</a></h1>
	<div class="entry-content">
		<p>This command will compress the directory <em>todays_backup</em> into the compressed file <em>todays_backup.tar.gz</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tar -zcf todays_backup.tar.gz todays_backup
</span></code></pre></td></tr></table></div></figure>


<p>To decompress it use the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tar -zxf todays_backup.tar.gz
</span></code></pre></td></tr></table></div></figure>


<p>Now to the fun part. Let’s look at how we can add a basic level of encryption to the process we used above. To compress the directory <em>todays_backup</em> with protection do the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tar -zcf – todays_backup|openssl des3 -salt -k yourpassword | dd <span class="nv">of</span><span class="o">=</span>todays_backup.des3
</span></code></pre></td></tr></table></div></figure>


<p>Replace <em>yourpassword</em> with a password of your own. Keep the password to yourself, and keep it carefully. The above command will generate a file called <em>todays_backup.des3</em>. This file can only be decompressed using this password.</p>

<p>To extract your protected archive <em>todays_backup.des3</em> use the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dd <span class="k">if</span><span class="o">=</span> todays_backup.des3 |openssl des3 -d -k yourpassword |tar zxf -
</span></code></pre></td></tr></table></div></figure>


<p>Make note of the trailing <em>-</em> at the end. It is not a typo, but a requirement for this command to work. Replace <em>yourpassword</em> with the password you used while encrypting the file. Executing the above command will extract the compressed file <em>todays_backup.des3</em> into a directory <em>todays_backup</em>. Use this encryption with care. As I said earlier, the only way you can retrieve your data once secured is by using the password, so do not lose this password under any circumstances.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-31T14:01:57-07:00" pubdate data-updated="true">Aug 31<span>st</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/31/tcpdump-capture-packets-while-connected-on-ssh/">Tcpdump Capture Packets While Connected on SSH</a></h1>
	<div class="entry-content">
		<p>tcpdump by default will listen and output everything, including your current SSH session, which means you&#8217;ll get a lot of junk!</p>

<p>so do this to ignore all ssh connections to filter them out</p>

<p>tcpdump -i any -s 0 not port ssh</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-30T14:49:00-07:00" pubdate data-updated="true">Aug 30<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/30/allow-only-certain-sites-with-squid/">Allow Only Certain Sites With Squid</a></h1>
	<div class="entry-content">
		<p>first create /etc/squid/allowed-sites</p>

<p>add the list of domains you wish to allow, for instance:</p>

<p>.yahoo.com<br/>
.softlayer.com</p>

<p>now edit /etc/squid/squid.conf and modify as follows (remember to place these just before &#8220;http_access deny all&#8221;:</p>

<p>acl allowed_network src 1.1.1.0/24<br/>
acl allowed_sites dstdomain &#8220;/etc/squid/allowed-sites&#8221;<br/>
http_access allow allowed_network allowed_sites<br/>
http_access deny allowed_network !allowed_sites</p>

<p>now save and reload squid</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-30T11:19:00-07:00" pubdate data-updated="true">Aug 30<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/30/setup-a-proxy-server-on-centos-for-internal-servers-to/">Setup a Proxy Server on Centos for Internal Servers to Use</a></h1>
	<div class="entry-content">
		<h3>setting up a proxy server that does, DNS, http/https</h3>

<h1>[setup bind on proxy server]</h1>

<p>yum install bind -y</p>

<h1>create /etc/named.conf, replace 1.1.1.0 with your LAN servers ip range:</h1>

<p>options {</p>

<p>        listen-on port 53 { 127.0.0.1; 1.1.1.0/24; };</p>

<p>        listen-on-v6 port 53 { ::1; };</p>

<p>        directory       &#8220;/var/named&#8221;;</p>

<p>        dump-file       &#8220;/var/named/data/cache_dump.db&#8221;;</p>

<p>        statistics-file &#8220;/var/named/data/named_stats.txt&#8221;;</p>

<p>        memstatistics-file &#8220;/var/named/data/named_mem_stats.txt&#8221;;</p>

<p>        allow-query     { localhost; 1.1.1.0/24; };</p>

<p>        allow-query-cache { localhost; 1.1.1.0/24; };</p>

<p>};</p>

<p>logging {</p>

<p>        channel default_debug {</p>

<p>                file &#8220;data/named.run&#8221;;</p>

<p>                severity dynamic;</p>

<p>        };</p>

<p>};</p>

<p>view localhost_resolver {</p>

<p>        match-clients      { localhost; 1.1.1.0/24; };</p>

<p>        match-destinations { localhost; 1.1.1.0/24; };</p>

<p>        recursion yes;</p>

<p>        include &#8220;/etc/named.rfc1912.zones&#8221;;</p>

<p>};</p>

<h1>restart bind</h1>

<p>chkconfig named on</p>

<p>service named restart</p>

<h1>[setup squid on proxy server]</h1>

<p>yum install squid -y</p>

<p>chkconfig squid on</p>

<h1>modify /etc/squid.conf</h1>

<h1>uncomment these two lines and set the IPs you wish to grant access to</h1>

<p>acl our_networks src 1.1.1.0/24</p>

<p>http_access allow our_networks</p>

<h1>restart squid</h1>

<p>service squid start</p>

<h1>[now setup client servers to use proxy server]</h1>

<h1>easiest way is to add this line to your /etc/bashrc</h1>

<p>http_proxy=&#8221;http://proxyserver:3128&#8221;<br/>
ftp_proxy=&#8221;http://proxyserver:3128&#8221;  </p>

<p>export http_proxy<br/>
export ftp_proxy  </p>

<h1>re-login </h1>

<p>………..</p>

<p>that&#8217;s it. now all your internal/private servers can access the internet.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-29T20:24:00-07:00" pubdate data-updated="true">Aug 29<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/29/how-to-setup-a-local-yum-repo-mirror/">How to Setup a Local Yum Repo/mirror</a></h1>
	<div class="entry-content">
		<p>I&#8217;ve spent some countless hours fiddling around rsync&#8217;ing many public mirrors praying it supports directory crawling.</p>

<p>Well those days are no more, it seems there was a utility that handles mirroring your current yum packages repos identically to be distributed to your other servers.</p>

<p>It&#8217;s called &#8220;reposync&#8221; and rightly named. You might need to yum install yum-utils.</p>

<p>Now, just do:</p>

<p>reposync -p -v /var/www/html/yumrepos</p>

<p>This might take a while, especially the main OS base packages. </p>

<p>Once done, you need to create metadata so it can be accessed via yum, to do so, you need to run createrepo:</p>

<p>createrepo -s sha /var/www/html/yumrepos/reponame_goes_here</p>

<p>Do this for each of the repositories you have.</p>

<p>Now, point your other servers to use your new proxy server for yum updates.</p>

<p>One thing to note is that some repositories require GPG keys, such as EPEL, so make sure you copy over your /etc/pki/rpm-gpg/* files on your repo server to your other servers.</p>

<p>This site has a bit more detailed instructions:</p>

<p><a href="http://icseplus.blogspot.com/2012/08/create-you-own-repo-server.html?zx=28f949eb9f42c164">[http://icseplus.blogspot.com/2012/08/create-you-own-repo-server.html?zx=28f949eb9f42c164](http://icseplus.blogspot.com/2012/08/create-you-own-repo-server.html?zx=28f949eb9f42c164)</a></p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-27T21:51:00-07:00" pubdate data-updated="true">Aug 27<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/27/log-all-root-commands/">Log All Root Commands</a></h1>
	<div class="entry-content">
		<p>PROMPT_COMMAND=&#8217;history -a >(tee -a ~/.bash_history | logger -t &#8220;$USER[$$] $SSH_CONNECTION&#8221;)&#8217;</p>

<p>add this to /root/.bashrc and it will log all to syslog/rsyslog messages</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-16T08:41:06-07:00" pubdate data-updated="true">Aug 16<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/16/warning-rsyslogd-is-running-in-compatibility-mode/">WARNING: Rsyslogd Is Running in Compatibility Mode. Automatically Generated Config Directives May Interfer With Your rsyslog.conf Settings. We Suggest Upgrading Your Config and Adding -c3 as the First Rsyslogd Option.</a></h1>
	<div class="entry-content">
		<p>If you are getting the error:</p>

<p>WARNING: rsyslogd is running in compatibility mode. Automatically generated config directives may interfer with your rsyslog.conf settings. We suggest upgrading your config and adding -c3 as the first rsyslogd option.</p>

<p>when starting up your rsyslog, do this:</p>

<p>edit /etc/sysconfig/syslog</p>

<p>and add -c5 in your options like this:</p>

<p>SYSLOGD_OPTIONS=&#8221;-c5 -m 0&#8221;</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-16T08:39:38-07:00" pubdate data-updated="true">Aug 16<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/16/dev-xvc0-no-such-file-or-directory/">/dev/xvc0: No Such File or Directory</a></h1>
	<div class="entry-content">
		<p>So I been getting a lot of these errors lately.</p>

<p>It&#8217;s due to some legacy XEN images. Here&#8217;s how to get rid of it:</p>

<p>edit /etc/inittab</p>

<p>find the line, co:2345:respawn:/sbin/agetty xvc0 9600 vt100-nav</p>

<p>and comment it out, like so:</p>

<h1>co:2345:respawn:/sbin/agetty xvc0 9600 vt100-nav</h1>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-15T11:48:00-07:00" pubdate data-updated="true">Aug 15<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/15/creating-a-vnc-tunnel-using-freenx/">Creating a VNC Tunnel Using freeNX</a></h1>
	<div class="entry-content">
		<p>I found a pretty cool VNC alternative, which I think surpasses all other solutions out there.</p>

<p>Installation is very easy too!</p>

<p>on centos:</p>

<p>yum groupinstall &#8220;X Window System&#8221; &#8220;KDE (K Desktop Environment)&#8221;<br/>
yum install nx freenx<br/>
nxserver &#8211;start</p>

<p>Now nx server is installed and should be awaiting connections!</p>

<p>Download the NX Client for Windows/Mac (for macs, i think you have to use something else)</p>

<p>Now on password, click &#8220;choose key&#8221;. Copy and paste this on to that textarea:</p>

<p>cat /var/lib/nxserver/home/.ssh/client.id_dsa.key</p>

<p>Once done, put in your server hostname info, etc.. and you should be able to connect.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-09T09:31:35-07:00" pubdate data-updated="true">Aug 9<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/09/openvpn-stuck-on-obtaining-configuration-for-windows/">Openvpn Stuck on Obtaining Configuration for Windows</a></h1>
	<div class="entry-content">
		<p>So i been using openvpn to connect to our internal servers.<br/>
I noticed that some of my other co-workers had issue connecting to the VPN, they would get stuck on the screen saying:</p>

<p>&#8220;Obtaining configuration&#8221;</p>

<p>This was odd to me and I couldn&#8217;t reproduce this so I thought something was wrong with their PC.</p>

<p>But just today, I too had this same behaviour and I was locked out. I decided to wonder if this was a VPN client issue and I tested on my Mac via TunnelBlick, and it was able to connect fine.</p>

<p>So I knew the problem was with the openVPN client software and decided to look for an alternative, I wish there was a TunnelBlick for Windows but Mac only.</p>

<p>I stumbled across Sparklab&#8217;s Viscosity VPN client. I installed via free trial and I was able to connect!</p>

<p><a href="http://www.thesparklabs.com/viscosity/">[http://www.thesparklabs.com/viscosity/](http://www.thesparklabs.com/viscosity/)</a></p>

<p>I hate to pay for it but it seems at the moment, I don&#8217;t have a choice. It&#8217;s only $9 lifetime, fairly cheap.</p>

<p>Anyhow, problem solved.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-08-09T09:27:59-07:00" pubdate data-updated="true">Aug 9<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/08/09/openvpn-stuck-on-obtaining-configuration-for-windows-2/">Openvpn Stuck on Obtaining Configuration for Windows</a></h1>
	<div class="entry-content">
		<p>So i been using openvpn to connect to our internal servers.<br/>
I noticed that some of my other co-workers had issue connecting to the VPN, they would get stuck on the screen saying:</p>

<p>&#8220;Obtaining configuration&#8221;</p>

<p>This was odd to me and I couldn&#8217;t reproduce this so I thought something was wrong with their PC.</p>

<p>But just today, I too had this same behaviour and I was locked out. I decided to wonder if this was a VPN client issue and I tested on my Mac via TunnelBlick, and it was able to connect fine.</p>

<p>So I knew the problem was with the openVPN client software and decided to look for an alternative, I wish there was a TunnelBlick for Windows but Mac only.</p>

<p>I stumbled across <a href="http://www.viscosity.com">www.viscosity.com</a>. I installed via free trial and I was able to connect!</p>

<p>I hate to pay for it but it seems at the moment, I don&#8217;t have a choice.</p>

<p>Anyhow, problem solved.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-07-30T19:44:23-07:00" pubdate data-updated="true">Jul 30<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/07/30/ssh-tunnel-multiple-servers/">Ssh Tunnel Multiple Servers</a></h1>
	<div class="entry-content">
		<p>i have a bastion server i need to connect to access other servers.<br/>
this pose some problems when i require a need to access a web-gui within the internal servers, such as ASL admin gui or other control panels, etc …</p>

<p>here is a simple way to forward a port from my target server to my localhost specified port:</p>

<p>ssh -t -t -L8081:localhost:10000 mvriel@a.server.example.com &#8216;ssh -L10000:localhost:80 mvriel@b.server.example.com&#8217; </p>

<p>now when i point my browser to http://localhost:8081, i am viewing the port 80 from server b.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-07-09T21:56:17-07:00" pubdate data-updated="true">Jul 9<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/07/09/ssh-tunnel-how-to-condensed/">SSH Tunnel How to (Condensed)</a></h1>
	<div class="entry-content">
		<p>I have a Private Cloud under firewall and I needed to run Nessus on our internal network.</p>

<p>Problem is, I&#8217;d have no way to access the web-gui unless I explicitly expose the port on the firewall, something I&#8217;d not want to do.</p>

<p>It appeared SSH Tunneling is what I needed. It sounded simple enough, but in practice, I just couldn&#8217;t get my head around it.</p>

<p>Why? Mainly because I was on Windows w/ Linux on Virtualbox. So the whole concept of me opening a tunnel didn&#8217;t make sense to me as Windows box won&#8217;t have access to the tunnel.</p>

<p>I read there are some ways you can do it through Putty but that in itself was quite an exercise. Randomly, I was on a mac, googling for SSH tunnel and all of a sudden it all made sense. </p>

<p>From terminal:</p>

<p>ssh -N -L 2080:internalserver1:80 root@publicserver</p>

<p>It&#8217;ll appear as if nothing happened, as you&#8217;ll get no response output.</p>

<p>But now, point your browser to http://localhost:2080</p>

<p>And you&#8217;ll see that it&#8217;s loading the website from internalserver. Voila.</p>

<p>I hope this made far clearer sense than other pages that teaches you about SSH tunneling.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-07-02T09:26:00-07:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/07/02/remote-system-logging-to-mysql-with-rsyslog-in-centos/">Remote System Logging to Mysql With Rsyslog in Centos 5.8</a></h1>
	<div class="entry-content">
		<p>Gathering information message is important on Data Center, in some situations you’ll want to store all entries of logfiles on another server. If a server crashes or gets hacked it will be able to trace through  logfiles from your machine. this is can be accomplished by using centralized log server that receive messages from another hosts.  A syslog facility can receive messages from Unix/Linux hosts but also network devices and windows hosts.</p>

<p>In this post, I want to explain step installation of Rsyslog, and Centralized log using MySQL Database. And using LogAnalyzer web interface, for graphical view and administrative.</p>

<p>Step Installation:</p>

<p><strong>1. First we need to install the following packages:</strong></p>

<p><code># yum install rsyslog rsyslog-mysql mysql-server php-mysql php-gd httpd mod_ssl</code></p>

<p><strong>2. Configure rsyslog, mysqld, and httpd to run on startup:</strong></p>

<p>`#  chkconfig &#8211;add rsyslog</p>

<h1>  chkconfig &#8211;add mysqld</h1>

<h1>  chkconfig &#8211;add httpd</h1>

<h1>  chkconfig rsyslog on</h1>

<h1>  chkconfig httpd on</h1>

<h1>  chkconfig mysqld on</h1>

<h1>  service rsyslog start</h1>

<h1>  service mysqld start</h1>

<h1>  service httpd start`</h1>

<p><strong>3.  Configure RSyslog with MySQL Database Connection
</strong></p>

<p>Assuming for example:
user: root
password: sql password
host: localhost
db to create: Rsyslogdb
RSyslog-mysql database installation path: /usr/share/doc/rsyslog-mysql-2.0.0/createDB.sql</p>

<p>Create database:
<code># mysql –u root –psqlpassword
mysql&gt; CREATE DATABASE Rsyslogdb;</code></p>

<p>Export rsyslog database table:
<code># mysql –u root –psqlpassword Rsyslogdb &lt; /usr/share/doc/rsyslog-mysql-2.0.0/createDB.sql</code></p>

<p>Setup MySQL permission (must be same with /etc/rsyslog.conf and /path/to/loganalyzer/config.php)
<code># mysql –u root –psqlpassword
mysql&gt; GRANT ALL ON Rsyslogdb.* TO ‘root’@’localhost’ IDENTIFIED BY 'sqlpassword';</code></p>

<p><strong>4. Configure RSyslog</strong></p>

<p>edit rsyslog configuration file
<code>vi /etc/rsyslog.conf</code></p>

<p>add this line below:
`$ModLoad ommysql
$ModLoad imuxsock
$ModLoad imklog
$Modload imudp
$UDPServerRun 514
$Modload imtcp
$InputTCPServerRun 514</p>

<h2>Optional</h2>

<h1>$UDPServerAddress 0.0.0.0</h1>

<h2>Optional</h2>

<h1>$RepeatedMsgReduction ()</h1>

<p>$template dbFormat,&#8221;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (&#8216;%msg%&#8217;, %syslogfacility%, &#8216;%HOSTNAME%&#8217;,%syslogpriority%, &#8216;%timereported:::date-mysql%&#8217;, &#8216;%timegenerated:::date-mysql%&#8217;, %iut%, &#8216;%syslogtag%&#8217;)&#8221;,sql
<em>.</em>       : ommysql:localhost,Ryslog,root,sqlpassword
<em>.info;mail.none;authpriv.none;cron.none            /var/log/messages
authpriv.</em>                                          /var/log/secure
mail.<em>                                              /var/log/maillog
cron.</em>                                              /var/log/cron
<em>.emerg                                             *
uucp,news.crit                                      /var/log/spooler
local7.</em>                                             /var/log/boot.log`</p>

<p><strong>5. Restarting rsyslog service:</strong>
<code># service rsyslog restart</code></p>

<p><strong>6. Centralized Syslog Server</strong>
Edit file:  /etc/sysconfig/rsyslog  (add this line)
<code># vi /etc/sysconfig/rsyslog
SYSLOGD_OPTIONS="-c3"</code></p>

<p><strong>7. Log Analyzer Installation</strong>
Download the latest installation :
<a href="http://loganalyzer.adiscon.com/downloads">http://loganalyzer.adiscon.com/downloads</a></p>

<p>`# cd /tmp</p>

<h1>wget <a href="http://download.adiscon.com/loganalyzer/loganalyzer-3.0.6.tar.gz">http://download.adiscon.com/loganalyzer/loganalyzer-3.0.6.tar.gz</a></h1>

<h1>tar -zxvf loganalyzer-3.0.6.tar.gz</h1>

<h1>cd loganalyzer-3.0.6/src/</h1>

<h1>mkdir /var/www/html/Rsyslog</h1>

<h1>cp –R * /var/www/html/Rsyslog</h1>

<h1>cp ../contrib/configure.sh /var/www/html/</h1>

<h1>chmod +x configure.sh</h1>

<h1>./configure.sh`</h1>

<p>After you execute configuration.sh files, it will create an empty config.php that used for Log Analyzer Configuration.</p>

<p>Open your favorite web browser and navigate into your homepage (i.e: <a href="http://localhost/">http://localhost</a>), then fill in and follow the Log Analyzer configuration steps to complete. From here RSyslog can be displayed on Show Events tab, choose MySQL Native to load your syslog messages on this machine into your RSyslog database on MySQL.</p>

<p><a href="http://gembuls.files.wordpress.com/2011/02/rsyslog1.jpg">
</a>Done!</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-06-29T16:25:00-07:00" pubdate data-updated="true">Jun 29<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/06/29/disable-emacs-backup-file/">Disable Emacs Backup File</a></h1>
	<div class="entry-content">
		<p>Edit/create a ~/.emacs file in your home directory.</p>

<p>(1). prevent the creation of backup files:</p>

<pre><code>&lt;code&gt;(setq make-backup-files nil) &lt;/code&gt;
</code></pre>

<p>or</p>

<p>(2). Have it save the backup files in some other directory, where they won&#8217;t bother you unless you go looking for them. I have the following in my .emacs:</p>

<pre><code>&lt;code&gt;(setq backup-directory-alist '(("." . "~/.emacs.d/backup")) backup-by-copying t ; Don't delink hardlinks version-control t ; Use version numbers on backups delete-old-versions t ; Automatically delete excess backups kept-new-versions 20 ; how many of the newest versions to keep kept-old-versions 5 ; and how many of the old )&lt;/code&gt;
</code></pre>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-06-26T09:26:08-07:00" pubdate data-updated="true">Jun 26<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/06/26/changing-the-default-bash-color-scheme/">Changing the Default Bash Color Scheme</a></h1>
	<div class="entry-content">
		<p>edit .bashrc</p>

<p>paste this:</p>

<p>LS_COLORS=&#8217;di=35:fi=0:ln=31:pi=5:so=5:bd=5:cd=5:or=31:mi=0:ex=32:*.rpm=90&#8217;<br/>
export LS_COLORS</p>

<p>it will show magenta for dir and green for files</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-06-20T15:51:23-07:00" pubdate data-updated="true">Jun 20<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/06/20/change-document-root-in-cpanel-for-primary-domains/">Change Document Root in Cpanel for Primary Domains</a></h1>
	<div class="entry-content">
		<p>So I needed to change document root of one of my accounts in cpanel.</p>

<p>I know I can do this for add-on and subdomains but I couldn&#8217;t find out how for account&#8217;s primary domain.</p>

<p>So here&#8217;s what I found:<br/>
 </p>

<p>Changing Primary domains</p>

<p>For changing the main/primary domain, you will need to have root SSH access and be able to locate and edit the following file (replacing your user &amp; domain info):</p>

<p>/var/cpanel/userdata/USERNAME/DOMAIN.COM</p>

<ol>
<li>Once you have opened the file, look for the following line:</li>
</ol>


<p>documentroot: /home/USERNAME/public_html</p>

<ol>
<li><p>Modify the location according to your needs. Save it and exit.</p></li>
<li><p>Rebuild the Apache conf and restart Apache:</p></li>
</ol>


<p>/scripts/rebuildhttpd.conf<br/>
service httpd restart</p>

<p>The change will be immediate. Simply clear your browser cache and force refresh the page!</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-06-08T11:50:21-07:00" pubdate data-updated="true">Jun 8<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/06/08/install-python-2-6-centos-5-8/">Install Python 2.6 Centos 5.8</a></h1>
	<div class="entry-content">
		<p><a href="http://agilesysadmin.net/recent-python-on-rhel-or-centos">[http://agilesysadmin.net/recent-python-on-rhel-or-centos](http://agilesysadmin.net/recent-python-on-rhel-or-centos)</a></p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-05-15T16:23:00-07:00" pubdate data-updated="true">May 15<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/05/15/running-tungsten-to-do-a-mysql-ha-multi-master-setup-w/">Running Tungsten to Do a Mysql HA Multi-master Setup W/ HAProxy</a></h1>
	<div class="entry-content">
		<h3>setup of tungsten on centos 5.8</h3>

<p>1) copy private key of root to other mysql servers</p>

<p>sudo su -</p>

<p>ssh-keygen</p>

<p>cd ~/.ssh</p>

<p>ssh-copy-id -i id_rsa.pub root@procdb1<br/>
 </p>

<p>2) install libraries</p>

<p>yum install ruby ruby-libs <br/>
 </p>

<p>3) install java</p>

<p>download and install the rpm <a href="http://www.oracle.com/technetwork/java/javase/downloads/jre-7u4-download-1591157.html">http://www.oracle.com/technetwork/java/javase/downloads/jre-7u4-download-1591157.html</a></p>

<p>4) add this to my.cnf and restart mysql</p>

<h3>tungsten ###</h3>

<p>server-id                               =       1 #set to 2 on other<br/>
log-bin                                 =       mysql-bin<br/>
innodb_flush_log_at_trx_commit          =       2<br/>
sync_binlog                             =       0<br/>
max_allowed_packet                      =       48m</p>

<h1>number of servers</h1>

<p>auto_increment_increment                =       2</p>

<h1>set this to 1, set to 2 on other</h1>

<p>auto_increment_offset                   =       1<br/>
 </p>

<p>5) create super account &#8216;tungsten&#8217; on all mysql servers</p>

<p>grant all privileges on <em>.</em> to tungsten IDENTIFIED BY &#8216;xxx&#8217; with grant option;</p>

<p>6) download tungsten replicator</p>

<p>wget <a href="http://tungsten-replicator.googlecode.com/files/tungsten-replicator-2.0.5.tar.gz">http://tungsten-replicator.googlecode.com/files/tungsten-replicator-2.0.5.tar.gz</a></p>

<p>7) create setup-multimaster.sh and run it</p>

<h1>! /bin/bash</h1>

<p>TUNGSTEN_HOME=/opt/replication</p>

<p>TUNGSTEN_TOOLS=tools</p>

<p>MASTER_USER=tungsten</p>

<p>MASTER_PW=xxxx</p>

<p>MASTER1=procdb0 #change to the hostname of your db</p>

<p>SERVICE1=$MASTER1</p>

<p>MASTER2=procdb1 #change to the hostname of your db</p>

<p>SERVICE2=$MASTER2</p>

<p>echo &#8216;setting up installer for &#8216;$MASTER1</p>

<p>./tools/tungsten-installer</p>

<p>    &#8211;master-slave</p>

<p>    &#8211;master-host=$MASTER1</p>

<p>    &#8211;datasource-user=$MASTER_USER</p>

<p>    &#8211;datasource-password=$MASTER_PW</p>

<p>    &#8211;service-name=$SERVICE1</p>

<p>    &#8211;home-directory=$TUNGSTEN_HOME</p>

<p>    &#8211;cluster-hosts=$MASTER1</p>

<p>    &#8211;start-and-report</p>

<p>echo &#8216;setting up installer for &#8216;$MASTER2</p>

<p>./tools/tungsten-installer</p>

<p>    &#8211;master-slave</p>

<p>    &#8211;master-host=$MASTER2</p>

<p>    &#8211;datasource-user=$MASTER_USER</p>

<p>    &#8211;datasource-password=$MASTER_PW</p>

<p>    &#8211;service-name=$SERVICE2</p>

<p>    &#8211;home-directory=$TUNGSTEN_HOME</p>

<p>    &#8211;cluster-hosts=$MASTER2</p>

<p>    &#8211;start-and-report</p>

<p>8) create configure-multimaster.sh and run it</p>

<h1>! /bin/bash</h1>

<p>TUNGSTEN_HOME=/opt/replication</p>

<p>TUNGSTEN_TOOLS=/opt/replication/tungsten/tools</p>

<p>MASTER1=procdb0 #change to the hostname of your db</p>

<p>SERVICE1=$MASTER1</p>

<p>MASTER2=procdb1 #change to the hostname of your db</p>

<p>SERVICE2=$MASTER2</p>

<p>echo &#8216;configure services for &#8216;$MASTER1</p>

<p>$TUNGSTEN_TOOLS/configure-service</p>

<p>   &#8211;host $MASTER1</p>

<p>   -C -q</p>

<p>   &#8211;local-service-name=$SERVICE1</p>

<p>   &#8211;role=slave</p>

<p>   &#8211;service-type=remote</p>

<p>   &#8211;datasource=$MASTER1</p>

<p>   &#8211;master-thl-host=$MASTER2</p>

<p>   &#8211;svc-start $SERVICE2</p>

<p>echo &#8216;configure services for &#8216;$MASTER2</p>

<p>$TUNGSTEN_TOOLS/configure-service</p>

<p>  &#8211;host $MASTER2</p>

<p>  -C -q</p>

<p>  &#8211;local-service-name=$SERVICE2</p>

<p>  &#8211;role=slave</p>

<p>  &#8211;service-type=remote</p>

<p>  &#8211;datasource=$MASTER2</p>

<p>  &#8211;master-thl-host=$MASTER1</p>

<p>  &#8211;svc-start $SERVICE1</p>

<p>9) All done, check if they are running</p>

<p>/opt/replication/tungsten/tungsten-replicator/bin/trepctl services<br/>
this should list two blocks of texts if everything is working correctly    </p>

<p>11) to stop or start replication, do:</p>

<p>/opt/replication/tungsten/tungsten-replicator/bin/replicator stop</p>

<p>/opt/replication/tungsten/tungsten-replicator/bin/replicator start</p>

<p>when server goes down or is rebooted, make sure to start the replicator as it&#8217;s not turned on automatically like mysql daemon. this to ensure you can just double check your data.</p>

<h3>configure haproxy for mysql multi-master</h3>

<p>12) setup haproxy</p>

<p>have heartbeat installed and make sure you&#8217;ve got a virtual ip for your db servers.</p>

<p>add these to the end of your /etc/haproxy/haproxy.cfg:</p>

<p>listen mysql-cluster</p>

<p>        bind x.x.y.y:3306 #virtual ip</p>

<p>        mode tcp</p>

<p>        balance roundrobin</p>

<p>        option tcpka</p>

<p>        option httpchk</p>

<p>        option mysql-check user root</p>

<p>        server procdb0 x.x.x.x:3306 check #db ip</p>

<p>        server procdb1 x.x.x.y:3306 check #db ip2</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-05-10T16:40:38-07:00" pubdate data-updated="true">May 10<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/05/10/the-real-mysql-5-5-master-slave-replication-how-to/">The REAL Mysql 5.5 Master Slave Replication How-to</a></h1>
	<div class="entry-content">
		<p>so i spent about half a day trying to get a simple mysql 5.5 master to slave replication going. mainly because 5.5 seems to have changed in how replication works, compared to the previous versions, so all the tutorials on google, didn&#8217;t work for me.</p>

<p>after trying out literally 5 different tutorials with no luck, i went to the trusted mysql&#8217;s documentation (i should do that more often), and i was able to follow their directions and finish replication in under 3 mins. o_O</p>

<p>so here&#8217;s the deal:</p>

<p>first go here <a href="http://dev.mysql.com/doc/refman/5.5/en/replication-howto.html">[http://dev.mysql.com/doc/refman/5.5/en/replication-howto.html](http://dev.mysql.com/doc/refman/5.5/en/replication-howto.html)</a> , follow exactly what they tell you to do step by step.</p>

<p>but since you are here, i&#8217;ll go ahead and list out the steps below:</p>

<h3>1) Setup the Master</h3>

<p>1) edit my.cnf (from a default my.cnf) and make sure you have these</p>

<p>[mysqld]<br/>
log-bin=mysql-bin<br/>
server-id=1</p>

<p>and now restart mysql</p>

<p>2) from mysql console</p>

<ul>
<li>add slave user:<br/>
grant replication slave ON <em>.</em> TO &#8216;slave&#8217;@&#8217;%&#8217; IDENTIFIED BY &#8216;test&#8217;;</li>
</ul>


<p>flush privileges; (not sure if it&#8217;s needed anymore but do it anyway for good measures)</p>

<ul>
<li>lock writes</li>
</ul>


<p>flush tables with read lock ;</p>

<ul>
<li>get your log file and log position (save these since you&#8217;ll need it later for slave setup)</li>
</ul>


<p>show master status;</p>

<h3>2) Setup the Slave</h3>

<p>1) edit my.cnf</p>

<p>[mysqld]<br/>
server-id=2</p>

<p>that&#8217;s all you need. restart mysql</p>

<p>2) load master&#8217;s database dump (optional), apparently you need to use mysql cli to load data, you can&#8217;t do &#8220;load data from master&#8221; anymore as it&#8217;s deprecated.</p>

<p>3) put in your master server and log details:</p>

<p>CHANGE MASTER TO MASTER_HOST=&#8217;ServerIP/FQDN&#8217;, MASTER_USER=&#8217;slave&#8217;, MASTER_PASSWORD=&#8217;test&#8217;, MASTER_LOG_FILE=&#8217;mysql-bin.000001&#8217;, MASTER_LOG_POS=98;</p>

<p>*Replace mysql-bin.0000001 and master_log_pos with what you got from &#8220;show master status&#8221; from Master server</p>

<p>4) start slave;</p>

<p>5) check if everything is cool by doing:</p>

<p>show slave statusG;</p>

<p>You should see stuffs like:</p>

<p>mysql> show slave statusG;</p>

<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em> 1. row </em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>

<p>               Slave_IO_State: Waiting for master to send event</p>

<p>                  Master_Host: mysql1</p>

<p>                  Master_User: slave_user</p>

<p>                  Master_Port: 3306</p>

<p>                Connect_Retry: 60</p>

<p>              Master_Log_File: mysql-bin.000005</p>

<p>          Read_Master_Log_Pos: 10383</p>

<p>if not something went wrong</p>

<h3>Almost done</h3>

<p>1) go back to master server mysql console and unlock the tables</p>

<p>unlock tables;</p>

<h3>Done</h3>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-02-29T15:45:49-08:00" pubdate data-updated="true">Feb 29<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/02/29/centos-6-w-nginx-php-5-3-php-fpm-fastcgi-apc/">CentOS 6 W/ Nginx + PHP 5.3 (PHP-FPM / FastCGI) + APC</a></h1>
	<div class="entry-content">
		<p><a href="http://rob.olmos.name/2010/08/centos-5-5-php-5-3-3-php-fpm-nginx-rpms/">[http://rob.olmos.name/2010/08/centos-5-5-php-5-3-3-php-fpm-nginx-rpms/](http://rob.olmos.name/2010/08/centos-5-5-php-5-3-3-php-fpm-nginx-rpms/)</a></p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-02-29T15:00:07-08:00" pubdate data-updated="true">Feb 29<span>th</span>, 2012</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title"><a href="/blog/2012/02/29/a-kindly-older-woman-told-me-that-happiness-is/">None</a></h1>
	<div class="entry-content">
		<blockquote><p>A kindly older woman told me that happiness is when the family is together. Given the fairly intact nature of the rural village, people looked pretty content with their lot.</p></blockquote>

<p><a href="http://www.fastcompany.com/1820974/buyology-martin-lindstrom-global-happiness">[http://www.fastcompany.com/1820974/buyology-martin-lindstrom-global-happiness](http://www.fastcompany.com/1820974/buyology-martin-lindstrom-global-happiness)</a></p>

		
		
	</div>

</article>

<nav id="pagenavi">
    
        <a href="/" class="prev">Prev</a>
    
    
        <a href="/blog/page/3/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - jaequery
  <!-- - <span class="credit">Powered by Jesus</span>-->
</p>

</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'jaequerycom';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-38367647-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
